<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SerendivWatcher | Sector Analysis</title>
    
        <!-- Bootstrap 5 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
        <!-- Shared Dark Theme CSS -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-theme.css') }}">
        
        <!-- Page-specific CSS for sector layout/alignment -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/sector.css') }}">
        
        <!-- LAYOUT FIX: Footer positioning for sectors page -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/sector-layout.css') }}">
    </head>
    
<body class="bg-dark-custom">

    <!-- Sidebar -->
    <div class="sidebar-dark">
        <div class="sidebar-header">
            <div class="brand-logo">
                <div class="logo-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="brand-text">
                    <h5>SerendivWatcher</h5>
                    <small>Intelligence Platform</small>
                </div>
            </div>
        </div>

        <div class="live-status-card">
            <div class="pulse-indicator"></div>
            <span class="status-text">System Active</span>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section-label">ANALYTICS</div>

            <a href="/" class="nav-link-dark {% if active_page == 'overview' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>

            <a href="/sectors" class="nav-link-dark {% if active_page == 'sectors' %}active{% endif %}">
                <i class="fas fa-layer-group"></i>
                <span>Sector Analysis</span>
            </a>

            <a href="/risks" class="nav-link-dark {% if active_page == 'risks' %}active{% endif %}">
                <i class="fas fa-shield-alt"></i>
                <span>Risk Intelligence</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile-card">
                <div class="avatar-gradient">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name">Analyst User</div>
                    <div class="user-role">System Adminstrator</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="main-wrapper">
        <!-- Top nav bar -->
        <nav class="navbar-dark-custom">
            <div class="container-fluid">
                <div class="navbar-left">
                    <h2 class="page-title">
                        <i class="fas fa-layer-group"></i>
                        <span class="text-gradient">Sector Analysis</span>
                    </h2>
                    <p class="page-subtitle">Operational environment indicators by sector</p>
                </div>
                <div class="navbar-right">
                    <div class="last-update-badge">
                        <i class="far fa-clock"></i>
                        <span>Updated a few minutes ago</span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-4 py-4">

            <!-- Header -->
            <section class="mb-4">
                <h4 class="section-title-dark">
                    <i class="fas fa-chart-simple text-gradient"></i>
                    Operational Environment Indicators
                </h4>
                <p class="section-subtitle-dark">
                    Sector-specific conditions affecting business operations and customer behavior
                </p>
            </section>

            <!-- Sector cards grid -->
            <div class="row g-4 mb-4">
                {% if data.sector_indicators %}
                    {% for sector_name, sector_data in data.sector_indicators.items() %}
                    <div class="col-xl-6 col-lg-6">
                        <article class="sector-card" data-sector="{{ sector_name|lower }}">
                            <div class="sector-card-body">

                                <!-- Header -->
                                <div class="sector-card-header">
                                    <div>
                                        <h5 class="sector-title">{{ sector_name|title }}</h5>
                                        <span class="sector-meta">{{ sector_data.article_count }} articles</span>
                                    </div>

                                    <span class="sector-sentiment-pill
                                        {% if sector_data.avg_sentiment > 0.1 %} pill-positive
                                        {% elif sector_data.avg_sentiment < -0.1 %} pill-negative
                                        {% else %} pill-neutral{% endif %}">
                                        {{ sector_data.sentiment_label|upper }}
                                    </span>
                                </div>

                                <!-- Sentiment score -->
                                <div class="sector-block">
                                    <span class="sector-block-label">Sentiment score</span>
                                    <div class="sector-score-row">
                                        <span class="sector-score
                                            {% if sector_data.avg_sentiment > 0 %} score-positive
                                            {% elif sector_data.avg_sentiment < 0 %} score-negative
                                            {% else %} score-neutral{% endif %}">
                                            {{ "%.3f"|format(sector_data.avg_sentiment) }}
                                        </span>
                                    </div>
                                    <div class="sector-bar">
                                        <div class="sector-bar-fill
                                            {% if sector_data.avg_sentiment >= 0 %} bar-positive
                                            {% else %} bar-negative{% endif %}"
                                             style="width: {{ ((sector_data.avg_sentiment + 1) / 2 * 100)|int }}%;"></div>
                                    </div>
                                </div>

                                <!-- Top keywords -->
                                <div class="sector-block">
                                    <span class="sector-block-label">Top keywords</span>
                                    <div class="sector-chip-row">
                                        {% for kw in sector_data.top_keywords[:5] %}
                                        <span class="chip chip-quiet">{{ kw.keyword }}</span>
                                        {% endfor %}
                                    </div>
                                </div>

                                <!-- Key players -->
                                {% if sector_data.top_organizations %}
                                <div class="sector-block">
                                    <span class="sector-block-label">Key players</span>
                                    <div class="sector-chip-row">
                                        {% for org in sector_data.top_organizations[:3] %}
                                        <span class="chip chip-soft">
                                            {{ org.org[:35] }}{% if org.org|length > 35 %}...{% endif %}
                                        </span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Centered More info button -->
                                <div class="sector-card-footer">
                                    <a href="{{ url_for('sector_detail', sector_name=sector_name|lower) }}"
                                       class="sector-more-btn"
                                       onclick="event.stopPropagation();">
                                        <span>More info</span>
                                        <i class="fa-solid fa-arrow-right"></i>
                                    </a>
                                </div>

                            </div>
                        </article>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="col-12">
                        <div class="card card-glass-dark text-center py-5">
                            <i class="fas fa-folder-open fa-2x text-muted mb-2"></i>
                            <p class="mb-0 text-muted">No sector data available</p>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Sentiment velocity -->
            <div class="card card-glass-dark mb-4">
                <div class="card-header-dark">
                    <h5 class="card-title-dark">
                        <i class="fas fa-gauge-high text-gradient"></i>
                        Sentiment Velocity Analysis
                    </h5>
                    <p class="card-subtitle-dark">Rate of sentiment change across sectors</p>
                </div>
                <div class="card-body">
                    <div class="velocity-grid">
                        {% if data.sentiment_velocity and data.sentiment_velocity.sector_velocities %}
                            {% for velocity in data.sentiment_velocity.sector_velocities[:6] %}
                            <div class="velocity-card-dark">
                                <div class="velocity-header-dark">
                                    <span class="sector-name">{{ velocity.sector|title }}</span>
                                    <span class="velocity-badge
                                        {% if velocity.velocity > 0.1 %}badge-success-soft
                                        {% elif velocity.velocity < -0.1 %}badge-danger-soft
                                        {% else %}badge-neutral-soft{% endif %}">
                                        <span class="velocity-dot
                                            {% if velocity.velocity > 0 %}
                                                velocity-dot-positive
                                            {% else %}
                                                velocity-dot-negative
                                            {% endif %}"></span>
                                        {{ "%.3f"|format(velocity.velocity|abs) }}
                                    </span>
                                </div>
                                <div class="velocity-meta">
                                    <span>Current: {{ "%.2f"|format(velocity.current_sentiment) }}</span>
                                    <span class="trend-badge">{{ velocity.trend|title }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4 text-muted">
                                <i class="fas fa-chart-line mb-2"></i>
                                <p class="mb-0">No velocity data available</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sector correlations -->
            <div class="card card-glass-dark mb-4">
                <div class="card-header-dark">
                    <h5 class="card-title-dark">
                        <i class="fas fa-diagram-project text-gradient"></i>
                        Sector Correlations
                    </h5>
                    <p class="card-subtitle-dark">Sectors frequently mentioned together</p>
                </div>
                <div class="card-body">
                    <div class="correlation-grid-dark">
                        {% if data.sector_correlations and data.sector_correlations.top_correlations %}
                            {% for corr in data.sector_correlations.top_correlations[:8] %}
                            <div class="correlation-card-dark">
                                <div class="correlation-sectors-dark">
                                    <span class="sector-badge-dark">{{ corr.sector1|title }}</span>
                                    <i class="fas fa-arrows-left-right"></i>
                                    <span class="sector-badge-dark">{{ corr.sector2|title }}</span>
                                </div>
                                <div class="correlation-stats-dark">
                                    <span class="co-occurrence">{{ corr.co_occurrence_count }} co-occurrences</span>
                                    <span class="badge badge-info-soft">
                                        {{ corr.correlation_strength|title }}
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4 text-muted">
                                <i class="fas fa-link mb-2"></i>
                                <p class="mb-0">No correlation data available</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

        </div>
        <footer class="footer-modern">
            <div class="footer-divider"></div>
            
            <div class="container-fluid px-4 py-5">
                <div class="row g-5 mb-4">
                    <!-- Brand Column -->
                    <div class="col-lg-5">
                        <div class="footer-brand-section">
                            <div class="footer-logo-modern">
                                <div class="logo-icon-gradient">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">SerendivWatcher</h4>
                                    <span class="badge badge-glass-subtle">Intelligence Platform</span>
                                </div>
                            </div>
                            
                            <p class="footer-tagline">
                                AI-powered business intelligence platform providing real-time sentiment 
                                analysis and market insights for Sri Lanka's economy.
                            </p>
                            
                            <div class="footer-social-modern">
                                <a href="#" class="social-btn" title="Twitter">
                                    <i class="fab fa-twitter"></i>
                                </a>
                                <a href="#" class="social-btn" title="LinkedIn">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                                <a href="#" class="social-btn" title="GitHub">
                                    <i class="fab fa-github"></i>
                                </a>
                                <a href="#" class="social-btn" title="Email">
                                    <i class="fas fa-envelope"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Links Grid -->
                    <div class="col-lg-7">
                        <div class="row g-4">
                            <!-- Platform -->
                            <div class="col-md-4">
                                <h6 class="footer-heading-modern">
                                    <i class="fas fa-layer-group"></i> Platform
                                </h6>
                                <ul class="footer-menu">
                                    <li><a href="/">Dashboard</a></li>
                                    <li><a href="/sectors">Sectors</a></li>
                                    <li><a href="/risks">Risk Analysis</a></li>
                                    <li><a href="/chatbot">AI Analyst</a></li>
                                </ul>
                            </div>

                            <!-- Resources -->
                            <div class="col-md-4">
                                <h6 class="footer-heading-modern">
                                    <i class="fas fa-book"></i> Resources
                                </h6>
                                <ul class="footer-menu">
                                    <li><a href="#">API Documentation</a></li>
                                    <li><a href="#">User Guide</a></li>
                                    <li><a href="#">Data Sources</a></li>
                                    <li><a href="#">Support</a></li>
                                </ul>
                            </div>

                            <!-- System Status -->
                            <div class="col-md-4">
                                <h6 class="footer-heading-modern">
                                    <i class="fas fa-server"></i> System Status
                                </h6>
                                <div class="status-list-modern">
                                    <div class="status-row">
                                        <span class="pulse-dot pulse-success"></span>
                                        <div class="status-info">
                                            <span class="status-label">Data Pipeline</span>
                                            <span class="status-value text-success">Operational</span>
                                        </div>
                                    </div>
                                    <div class="status-row">
                                        <span class="pulse-dot pulse-success"></span>
                                        <div class="status-info">
                                            <span class="status-label">AI Engine</span>
                                            <span class="status-value text-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="status-row">
                                        <span class="pulse-dot pulse-info"></span>
                                        <div class="status-info">
                                            <span class="status-label">Web Scrapers</span>
                                            <span class="status-value text-info">5/5 Online</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="last-scan-badge">
                                    <i class="fas fa-clock"></i>
                                    <span>Last scan: <strong>Just now</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Bottom -->
                <div class="footer-bottom-modern">
                    <div class="row align-items-center">
                        <div class="col-lg-6 text-center text-lg-start mb-3 mb-lg-0">
                            <p class="copyright-modern mb-0">
                                Â© 2025 <strong>SerendivWatcher</strong>. All rights reserved. 
                                <span class="heart-text">Built with <i class="fas fa-heart"></i> in Sri Lanka</span>
                            </p>
                        </div>
                        <div class="col-lg-6 text-center text-lg-end">
                            <div class="footer-legal-links">
                                <a href="#">Privacy Policy</a>
                                <a href="#">Terms of Service</a>
                                <a href="#">Data Policy</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Optional JSON dump -->
    <script>
        const dashboardData = {{ data | tojson | safe }};
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
